Grammar:		DataElement 5.0
Namespace:		shr.core

CodeSystem:		OBSCAT = http://hl7.org/fhir/observation-category


EntryElement:	Procedure
Based on:		ActionPerformed
Description:	"An action that is or was performed on or for a patient. This can be a physical intervention like an operation, or less invasive like long term services, counseling, or hypnotherapy."
// not implemented: instantiatesCanonical, instantiatesUri
0..1			BasedOn is type ProcedureBasedOn
0..1			PartOf is type ProcedurePartOf 
// Status from http://hl7.org/fhir/ValueSet/event-status conflicts with V2 http://hl7.org/fhir/ValueSet/procedure-status
0..1			StatusReason
0..1			Category  // max card constraint
1..1			Code from http://hl7.org/fhir/us/core/ValueSet/us-core-procedure-code if covered
				SubjectOfRecord value is type ref(Patient)
				CareContext value is type ref(Encounter)
0..1			Author is type PersonAuthor
0..1			InformationSource is type PersonInformationSource
				Participation.Participant is type ProcedureParticipant
				Participation.OnBehalfOf value is type ref(Organization)
0..1 			ref(Location)
0..1			ReasonCode
0..1			ReasonReference is type ProcedureReasonReference
0..*			BodyLocation
0..1			Outcome  could be from http://hl7.org/fhir/ValueSet/procedure-outcome
0..*			ref(DiagnosticReport)
0..*			ComplicationCode
0..*			ComplicationReference
0..*			FollowUp
0..*			Annotation
0..*			FocalDevice
0..0			Method	// Procedure doesn't have Method
// SHR Extension
0..1			TreatmentIntent
0..*			MaterialUsedReference
0..*			UsedCode

	Element:		MaterialUsedReference
	Based on:		UsedReference
	Description:	"Identifies medications, devices and any other substance used as part of the procedure."
	Value:			ref(Device) or ref(Medication) or ref(Substance)

	Element:		ComplicationCode
	Description:	"Complication following the procedure, as a code."
	Value:			CodeableConcept

	Element:		ComplicationReference
	Description:	"Complication following the procedure, as a reference to a Condition."
	Value:			ref(Condition)

	Element:		FollowUp
	Description:	"Instructions for follow up."
	Value:			CodeableConcept

	Element:		ProcedurePartOf
	Based on:		PartOf
	Description:	"A larger event of which this particular procedure is a component or step."
	Value:			ref(Procedure) or ref(MedicationAdministration) or ref(Observation)

	Element:		StatusReason
	Description:	"Captures the reason for the current state of the procedure."
	Value:			CodeableConcept

	Element:		ProcedureParticipant
	Based on:		Participant
	Description:	"Constrains participants to classes that are accepted by FHIR as actors in procedures in STU 3."
	Value:			ref(Practitioner) or ref(Organization) or ref(Patient) or ref(RelatedPerson) or ref(Device)

    Element:        TreatmentIntent
    Concept:        SCT#395077000 "Treatment intent (situation)"  // TODO: Needs a new LOINC number"
    Description:	"The purpose of a treatment."
    Value:          CodeableConcept from TreatmentIntentVS

	Element:		ProcedureBasedOn
	Based on:		BasedOn
	Description:	"A request for this procedure."
	Value:			ref(ProcedureRequest) or ref(ReferralRequest) or ref(ServiceRequest) // or CarePlan (or DiagnosticOrder in DSTU2)

	Element:		ProcedureReasonReference
	Based on:		ReasonReference
	Description:	"The justification that the procedure was performed."
	Value:			ref(Condition) or ref(Observation) or ref(Procedure) or ref(DiagnosticReport) or ref(DocumentReference)

	Element:		FocalDevice
	Description:	"Activity involving a device that is implanted, removed or otherwise manipulated (e.g., calibration, battery replacement, fitting a prosthesis, attaching a wound-vac, etc.) as a focal portion of the Procedure."
	1..1			ref(Device)
	0..1			FocalDeviceAction

		Element:		FocalDeviceAction
		Description:	"The kind of change that happened to the device during the procedure."
		Value:			CodeableConcept from http://hl7.org/fhir/ValueSet/device-action


EntryElement:	ProcedureRequest
Based on:		ServiceRequest
Description:	"A request for a procedure to be performed. May be a proposal or an order."
				RequestSubjectOfRecord is type ProcedureRequestSubjectOfRecord
0..1			Requester is type ProcedureRequester  
1..1			Code from http://hl7.org/fhir/us/core/ValueSet/us-core-procedure-code if covered
0..1			PartOf value is type ref(Procedure)
0..1			Category  // this is a constraint on the cardinality of Action.Category
0..1			ReasonCode  // limit upper card to 1 in DSTU2
0..1			ServiceReasonReference is type ProcedureRequestReasonReference // limit upper card to 1 in DSTU2
0..1			Method
//0..*			InputFinding  -- covered by Reason
//0..*			Indication
0..1			ExpectedPerformer  // restricted to 0..1 in DSTU2

		Element:		ProcedureRequester
		Based on:		Requester
		Description:	"The agent requesting the procedure. Allows Practitioner and Device, since these represent the intersection between DSTU 2 and STU 3. DSTU 2 allows Organization, and STU 3 allows Patient and RelatedPerson."
		Value:			ref(Practitioner) or ref(Device)

		Element:		ProcedureRequestSubjectOfRecord
		Based on:		RequestSubjectOfRecord
		Description:	"A choice of Patient or Group. These are the potential subjects for Procedure and ReferralRequest resources."
		Value:			ref(Patient) or ref(Group)

		Element:		ProcedureRequestReasonReference
		Based on:		ServiceReasonReference
		Description:	"The justification that the procedure was performed"
		Value:			ref(Condition) or ref(Observation)


//---------- Specialized Types of Procedures ----------------

EntryElement:	ImagingProcedure
Based on:		Procedure
Description:	"Experimental class for an imaging procedure. This class is still incomplete at this time."
0..*			ImagingSubstance

	Element:		ImagingSubstance
	Description:	"Substance used for this imaging procedure such as a contrast agent."
	Value:			CodeableConcept


EntryElement:	LaboratoryProcedure
Based on:		Procedure
Concept:		MTH#C0456984
Description:	"A procedure performed on a collected specimen such as a blood panel or a biopsy."
1..1			Code from http://hl7.org/fhir/ValueSet/observation-codes // ??
				Category is OBSCAT#laboratory
0..1			ref(Specimen)
//0..1 			ref(Device)   // constraint from 0..*


EntryElement:	SurgicalProcedure
Based on:		Procedure
				Participation.Participant is type PractitionerProcedureParticipant
				Code from SurgicalProcedureVS if covered // forced by Argonaut because they use an extensible binding
				BodyLocation is type SurgicalBodyLocation // includes the role of the body site in the procedure
				Method from SurgicalMethodVS

	Element:		SurgicalBodyLocation
	Based on:		BodyLocation
	Description:	"The site where the procedure is performed."
	0..1			SurgicalBodyLocationRole

	Element:		SurgicalBodyLocationRole
	Based on:		BodyLocation	
	Description:	"Describes the role played by the body site in the surgery."
	Value:			CodeableConcept from SurgicalBodyLocationRoleVS if covered

	Element:		PractitionerProcedureParticipant
	Based on:		ProcedureParticipant
	Description:	"Constrains participants to classes that are accepted by FHIR as actors in procedures in STU 3."
	Value:			ref(Practitioner)


EntryElement:   RadiationProcedure
Based on:       Procedure
Description:    "A radiation oncology procedure. If the treatment is part of a larger course of treatment, the PartOf attribute should indicate that."
				Participation.Participant is type PractitionerProcedureParticipant
    	    	Code from RadiationProcedureVS if covered
				BodyLocation.Code from RadiationTargetBodySiteVS if covered
0..1    		RadiationDosePerFraction
0..1    		RadiationFractionsDelivered
0..1    		TotalRadiationDoseDelivered
0..*			TerminationReason from TreatmentTerminationReasonVS
0..0			FocalDevice

Element:        RadiationDosePerFraction
Description:    "The total number of treatment sessions (fractions) administered during a course of radiation therapy therapy. A fraction is a portion of the total radiation dose, delivered as a series of treatments that make up the full course of radiotherapy. (source: LOINC)"
Value:          Ratio

Element:        RadiationFractionsDelivered
Concept:        LNC#21959-2 "Number of radiation treatment"
Description:    "The total number of treatment sessions (fractions) administered during a course of radiation therapy therapy. A fraction is a portion of the total radiation dose, delivered as a series of treatments that make up the full course of radiotherapy. (source: LOINC)"
Value:          Quantity with units UCUM#1

Element:        TotalRadiationDoseDelivered
Concept:        SCT#445461008 "Total radiation dose delivered (observable entity)"
Description:    "The total amount of radiation dose delivered for the course of therapy. (source: SNOMED, ASTRO)"
Value:          Quantity with units UCUM#Gy


EntryElement:   DiagnosticImaging
Based on:       ImagingProcedure
Description:    "Diagnostic imaging procedure performed."
                Code from DiagnosticImagingVS

/*
EntryElement:	SubstanceAbuseTreatment
Based on:		ProcedurePerformed
Description:	"The treatment program used to address a substance abuse problem."
				Code from SubstanceAbuseTreatmentTypeVS
*/